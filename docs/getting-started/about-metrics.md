---
title: "About Metrics"
---

By default, metrics are collected every 5 minutes, but you can adjust it with the `logsearch.metrics.frequency`
property. As an example, if you wanted to check once a minute, you could use the following:

    properties:
      logsearch:
        metrics:
          frequency: 60

If you prefer to completely disable this functionality, you can set `logsearch.metrics.enabled` to `false`.

Internally, metrics are treated as log file messages, so they use the same configuration documented in the Logs
section. This means the measurements will have several fields added, according to your defaults (e.g. `bosh_deployment`
and `bosh_job`). By default, metrics are also set with a `type` field set to `metric`.

Metrics are collected from several sources. The first set of metrics are enabled by default and come from the host:

 * `cpu` - idle, interrupt, nice, soft IRQ, steal, system, user, and wait (by core)
 * `disk` - merges, bytes, operations, and time (by read, write; by disk); disk space used, free, and reserved (by disk)
 * `loadavg` - short, mid, and long-term
 * `memory` - buffered, cached, free and used bytes
 * `network` - errors, bytes, and packets (by received, transmitted; by interface)
 * `processes` - blocked, paging, running, sleeping, stopped, and zombie states; fork rate
 * `swap` - cached, free, and used; I/O in and out
 * `users` - logged in

You can optionally disable those metrics by setting the respective `logsearch.metrics.host.{source}` property to
`false` (e.g. `logsearch.metrics.host.cpu: false`). These metrics are all named with a `host.` prefix.

A second set of metrics are automatically generated from the monit-managed processes and they include the following
(per process):

 * `children` - number of child processes
 * `cpu` - CPU usage of the parent and child processes
 * `memory` - memory (in bytes) of the parent and child processes
 * `status` - process status (0 = active, 1 = inactive, 2 = ignored)
 * `uptime` - seconds the process has been running

These metrics are enabled by default and are prefixed with `monit.` and the monit process name (e.g.
`monit.logsearch-logs.uptime`). If you prefer to disable these metrics, you can set the
`logsearch.metrics.monit` property to `false`.

The third set of metrics are generated by custom scripts. These scripts are run in an empty environment except for a
`METRIC_FREQUENCY` indicating how frequently it should collect metrics (in seconds). They should run indefinitely until
they receive an `INT` signal and they must output measurements to `STDOUT` in the following simple format:

    {metric-name:string} {metric-value:number} {unix-timestamp:integer}

By default, this release will auto-discover collector scripts which are named with the following convention:
`/var/vcap/jobs/{template-name}/logsearch/metric-collector/{collector-name}/collector`. Alternatively, you can use YAML
configuration documents using the following format to specify scripts in different locations, or override individual
settings per collector:

    collectors:
      {name}:
        enabled: {boolean=true}
        frequency: {integer=logsearch.metrics.frequency}
        exec: {string} # script executable path

Auto-discovered scripts are named using `{template-name}--{collector-name}`. As an example, take a look at the
[built-in `metrics.yml` file](./jobs/logsearch-shipper/templates/logsearch/metrics.yml.erb) which controls whether the
[built-in monit collector](./jobs/logsearch-shipper/templates/logsearch/metric-collector/monit/collector) (mentioned
earlier) is run.

Similar to configuring logs, you may store YAML configuration in the following locations:

 * property `logsearch.metrics._defaults`
 * files `/var/vcap/jobs/*/logsearch/metrics.yml`
 * property `logsearch.metrics._overrides`


# Naming

When you're writing metric collectors, you should follow these recommendations for metric names:

 * use namespaces, starting with the template and collector name
 * use `.` to separate namespace levels
 * use the character range of `a-z0-9._`
